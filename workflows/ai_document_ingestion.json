{
  "name": "AI Document Ingestion Pipeline",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "199f440f-d074-4c84-b322-eb02d2afe036",
              "name": "library_id",
              "value": "={{ $json.output.library_id }}",
              "type": "number"
            },
            {
              "id": "480628f6-e778-4153-9d1a-e780073368fe",
              "name": "doc_name",
              "value": "={{ $json.output.title }}",
              "type": "string"
            },
            {
              "id": "fc0bcb25-3b8d-41e8-9722-3a4b2501bf67",
              "name": "full_text",
              "value": "={{ $json.output.full_text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        576,
        264
      ],
      "id": "462d9aa6-1bb1-4a15-91f0-e7d8e34fc4e5",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "url": "=http://api:8000/libraries/{{ $json.library_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        800,
        264
      ],
      "id": "5cb9f3b6-521e-48ae-ac63-ec10e0211753",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://api:8000/documents/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"name\": \"{{ $('Edit Fields').item.json.doc_name }}\",\n  \"library_id\": {{ $('Edit Fields').item.json.library_id }}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1024,
        264
      ],
      "id": "aff208f6-e20d-461d-9eb9-83ab577e9cf5",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5ec2901f-f8f8-48ef-80ce-7ac058db4636",
              "name": "chunks_array",
              "value": "={{ $('Edit Fields').item.json.full_text.match(/((?:\\S+\\s*){1,10})/g) }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1248,
        264
      ],
      "id": "e311ace1-460f-4b60-816b-fcce387b234b",
      "name": "split_chunks"
    },
    {
      "parameters": {
        "fieldToSplitOut": "chunks_array",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1472,
        264
      ],
      "id": "58ad465f-039e-4760-a209-04fa366aee61",
      "name": "Split Out"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://api:8000/chunks",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "={{ $json.chunks_array }}"
            },
            {
              "name": "document_id",
              "value": "={{ $('HTTP Request1').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1696,
        264
      ],
      "id": "7e81021a-0e7b-430d-8a2a-73234d563ba3",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        0,
        264
      ],
      "id": "863814aa-8160-4303-85ae-1be170a4a94b",
      "name": "When chat message received",
      "webhookId": "448d8a0e-45b2-468a-92d7-e1f6850fdf45"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a Content Generator for a Vector Database.\nUser will ask you to create a document in a specific library about the topic that the user says.\n\n1. Extract the 'library_id' (integer).\n  IMPORTANT: if the user does not specify a library_id, use 0 as default.\n2. Generate a 'title' for the document.\n3. Write the 'full_text'. \n   âš ï¸ CRITICAL: The 'full_text' MUST be less than 100 words. Keep it concise.\n\nYou MUST reply with ONLY valid JSON.\nFormat:\n{\n  \"library_id\": 1,\n  \"title\": \"Example Title\",\n  \"full_text\": \"Short content goes here...\"\n} {{ $json.chatInput }}",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        224,
        264
      ],
      "id": "ba9f21a9-7fa0-4dae-9f55-bfe15ec7d7e1",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        232,
        488
      ],
      "id": "7aa55a97-1635-4a93-a039-6f34d2553f7e",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "JUsFROHQWLeI13jA",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"library_id\": 1,\n  \"title\": \"Example Title\",\n  \"full_text\": \"Content goes here...\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        360,
        488
      ],
      "id": "9d8ec96e-34d2-4007-ba0e-d59e7040108a",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://api:8000/libraries",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"name\": \"Library created from n8n\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        224,
        -64
      ],
      "id": "52fda652-e406-43ac-8b82-ef96b5edf96e",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "content": "# ðŸ¤– AI Agent: Content Generator & Ingester\n\n**What this workflow does:**\nThis is an **Agentic RAG Pipeline**. It takes a natural language command, generates content using AI, and automatically structures and ingests it into the Vector Database.\n\n**ðŸ› ï¸ Setup Required:**\n1. Double-click the **Google Gemini Chat Model** node.\n2. Select your API Credential (or create a new one with your API Key).\n\n### Avalable Triggers\n\n**Create a Library Button**\n - Automatically create a new library from n8n using the \"Create Library\" Button.\n\n\n\n**AI Content Generator Agent**\nAsk the AI agent to create a document about any topic in a given library id.\n\n1. Click the **Chat** button at the bottom of the screen.\n2. Type a command like:\n   > *\"Create a document about the history of the Internet.\"*\n   > *\"Create a document in Library 2 explaining how black holes work.\"*\n\n âš  You need at least 1 library to create a document. If you dont have one. Use the \"Create library button to create it automatically\"\n\n",
        "height": 816,
        "width": 464
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -544,
        -176
      ],
      "typeVersion": 1,
      "id": "18ec0b7b-b4af-4a0c-a6dc-6a9e5724996b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        0,
        -64
      ],
      "id": "6c34d1a7-2c0d-4d22-b421-36202029999a",
      "name": "When clicking â€˜Create Libraryâ€™"
    }
  ],
  "pinData": {},
  "connections": {
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "split_chunks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "split_chunks": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Create Libraryâ€™": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "384d899d-90c4-40b7-aa0c-f40317998e56",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "410fe99fb50f1ea6130ff15f59fb32a4f3746773534587f72da8b7d4a90f0fe3"
  },
  "id": "F9HFRqzxG8AzEeQV",
  "tags": []
}